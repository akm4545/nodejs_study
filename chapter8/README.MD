# **페이지네이션되는 게시판 만들기**  
# **프로젝트 구조 소개**  
프로젝트 구조는 N 계층 아키텍처를 따른다. MVC 패턴으로도 불리는 아주 유명하고 많이 쓰이는 구조다. 뷰는 유저가 보는 화면을 말한다. HTML 템플릿 엔진은 
핸들바(handlebars)로 작성한다. 컨트롤러는 따로 디렉터리를 구분하지는 않고 app.js안에 라우터 함수들로 분리한다. 서비스는 post-service.js 하나만 
만든다(원한다면 다양한 서비스를 만들 수 있다). 구조상으로는 모델에서 데이터베이스와 통신하게 되어 있지만 명시적으로 모델을 만들지는 않고 몽고디비 라이브러리의 
컬렉션 객체가 모델 역할을 한다.  
  
![img.png](image/img.png)  
  
# **게시판 프로젝트 셋업**  
프로젝트를 생성하고 익스프레스, 핸들바, 몽구스 패키지를 설치한다.  
  
# **Node.js 프로젝트 초기 설정**  
1. board 디렉터리를 만들고 npm init로 초기화한다.  
npm init -y  
  
# **익스프레스 설치 및 프로젝트 디렉터리 구조 잡기**  
1. 익스프레스 패키지를 설치한다.  
npm i express@4.17.3  
npm i mongodb@4.13.0  

2. 게시판 프로젝트의 디렉터리 구조를 잡는다.  
익스프레스는 마이크로 프레임워크다. 익스프레스 홈페이지에서는 미니멀리스트 웹 프레임워크로 소개한다. 표현은 다르지만 최소 기능을 가지면서 필요한 기능을 
플러그인으로 확장하는 프레임워크를 의미한다는 사실은 같다. 보통 모든 기능을 제공하는 풀스택 프레임워크들은 디렉터리 구조를 강제한다. 대표적으로 장고를 
들 수 있다. 반면 마이크로 프레임워크는 디렉터리 구조를 강제하지 않는다. 사용자에게 자유도를 주어 좋은 면도 있지만 좋은 디렉터리 구조를 사용자가 직접 
고민해야 한다.  
  
여기서는 서버 개발에서 가장 보편적으로 사용되는 3계층 구조(3 tier) 아키텍처를 적용한다. 3계층 구조는 웹 프레임워크에서 주로 사용하는 MVC 패턴을 
적용하기에도 좋다.  
  
3계층 구조는 다음과 같이 컨트롤러, 서비스, 데이터 액세스 계층을 갖는다. 컨트롤러 계층에서는 뷰에서 넘어온 요청을 받아서 권한 체크, 유효성 검증 등을 
한 후에 서비스 계층으로 넘긴다. 서비스 계층에서는 비즈니스 로직을 처리한다. 서비스로 비즈니스 로직을 분리하면 각각 다른 컨트롤러에서 같은 서비스를 
재사용할 수 있게 된다. 서비스에서 DB에 데이터를 저장할 때는 데이터 엑세스 계층과 데이터를 주고받는다. 이 경우 정의해둔 모델을 넘기는 것이 일반적이다.  
  
![img.png](image/img2.png)  
  
익스프레스에서 컨트롤러 역할은 라우터가 한다. 서비스 계층은 비즈니스 로직을 구현하는 부분이므로 각 프로젝트에서 해당 역할을 하는 클래스 또는 함수를 
작성해야 한다. 몽고디비 모듈이 데이터 액세스 계층 역할을 해주게 된다. 필요에 따라서 데이터 액세스 계층을 따로 작성하는 경우도 있다.  
  
3계층 아키텍처는 서버의 관점에서 데이터와 파일을 어떻게 관리할지 정리한 것이지만 게시판 프로젝트에서는 웹페이지도 있다.  
  
![img.png](image/img3.png)  
  
디렉터를 각 계층별로 만든다. 뷰 관련 파일은 views 디렉터리, 컨트롤러 관련 파일은 controllers 디렉터리, 서비스 관련 파일은 services 디렉터리를 
사용한다. 다만 이번 장에서 다루는 API들이 많지 않으므로 라우터와 컨트롤러 코드는 app.js에 모두 작성한다. 마지막으로 각 모듈에서 사용할 설정 파일이 
필요한 경우도 있다. 설정 파일을 모아놓을 configs 디렉터리도 생성한다.  
  
3. 프로젝트의 디렉터리 구조는 다음과 같다. 디렉터리와 파일을 생성한다.  
  
![img.png](image/img4.png)  
  
# **핸들바 템플릿 엔진 설치 및 설정하기**  
API만 만드는 것이라면 템플릿 엔진이 필요 없다. 뷰로 웹페이지를 보여주므로 템플릿 엔진을 설정해야 컨트롤러에서 넘기는 데이터를 웹페이지에 제대로 표현할 
수 있다.  
  
익스프레스에서 사용하는 템플릿 엔진으로는 퍼그(Pug), EJS, 머스태시(mustache)등이 있지만 퍼그는 HTML이 아닌 다른 포맷으로 웹페이지를 작성해야 하므로 
제외한다. EJS는 표션식이 좀 지저분하다. 머스태시는 다양한 언어에서 사용되는 템플릿 엔진과 유사하지만 핸들바에 비해 기능이 적다. 핸들바는 머스태시와 
호환되면서 추가 기능을 제공하므로 핸들바를 사용한다.  
  
1. 핸드바 express-handlebars를 설치한다. 익스프레스용 핸들바 패키지는 express-handlebars와 express-hbs 두 가지가 있다. express-hbs가 조금 
더 많은 기능을 제공하지만 2023년 시점으로 마지막 버전이 2년 전에 공개되었다. 이에 기능은 조금 더 적더라도 관리가 잘되고 있는 express-handlebars를 
사용한다. 많은 차이는 없으므로 둘 중 어느 것을 사용해도 크게 문제는 없다.  
  
npm i express-handlebars@6.0.3  
  
2. 설치가 잘되었으면 설정을 진행한다. app.js 파일을 생성하고 작성한다.  
board/app.js  
  
app.engine은 익스프레스에서 사용할 템플릿 엔진을 등록하는 코드다. handlebars는 파일의 확장자로 사용할 이름이다. hbs 등의 다른 이름으로 변경할 수 있지만 
핸들바 엔진 내부에서 handlebars로 사용하고 있으므로 변경하지 않는다. 파일이 많아지면 변경하는 것도 좋다.  
  
엔진을 설정했지만 웹페이지에서 사용할 템플릿 엔진도 설정해야 한다. 설정 시에는 엔진 설정 시의 이름 "handlebars"로 설정해 준다. 이름을 hbs로 했다면 여기서
도 hbs로 해야한다.  
  
views는 뷰로 사용할 파일들의 디렉터리를 설정하는 코드다. 기본적으로 views로 되어 있지만 node를 실행하는 디렉터리의 상대 경로로 지정된다. 상대 경로로 
되어 있을 때 다른 디렉터리에서 node를 실행하면 문제가 생길 수 있으므로 __dirname을 사용해 절대 경로로 지정한다. __dirname은 node를 실행하는 
디렉터리 경로다.  
  
라우팅 코드의 home은 템플릿 파일의 이름이다. views가 기본 경로이고 handlebars가 확장자이므로 views/home.handlebars 파일에 데이터를 렌더링한다. 
렌더링 시에 title과 message 값이 객체로 들어가게 된다.  
  
3. views 안에 layouts를 만들고 그 안에 main.handlebars 템플릿 파일을 생성한다. 핸들바 템플릿 엔진에서는 기본 형태가 되는 템플릿 파일을 선언하고 다른 
템플릿에서는 내용(body 태그 부분)만 변경하는 것이 기본 설정이다. main 템플릿을 사용하지 않으려면 결괏값의 json의 속성에 layout:false를 추가하면 
된다.  
  
board/views/layouts/main.handlebars  
  
{{{body}}}에 다른 핸들바 템플릿의 코드가 그대로 들어가게 된다.  
  
handlebars.engine에 layoutsDir 항목을 추가하면 기본 레이아웃 디렉터리를 변경할 수 있다.  
app.engine("handlebars", handlebars.engine({ layoutsDir: "views" ));  
  
혹은 기본 레이아웃을 사용하고 싶지 않으면 라우터의 결과 객체에 layout:false를 추가하면 된다.  
res.render("home", { title: "aa", message: "aa", layout: false });  
  
4. body에 삽입할 템플릿을 views 디렉터리 아래에 만든다.  
board/views/home.handlebars  
  
핸들바는 렌더링 시 {{ 변수명 }}으로 되어 있는 부분에 변수의 값을 넣어준다.  
  
![img.png](image/img5.png)  
  
5. node app.js를 실행 후 테스트를 진행한다.  
  
# **화면 기획하기**  
# **리스트 화면 기획**  
![img.png](image/img6.png)  
  
# **글쓰기 화면 기획**  
![img.png](image/img7.png)  
  
# **상세 화면 기획**  
![img.png](image/img8.png)  
  
